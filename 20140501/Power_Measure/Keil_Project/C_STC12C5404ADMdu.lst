C51 COMPILER V8.08   C_STC12C5404ADMDU                                                     07/29/2010 17:32:26 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE C_STC12C5404ADMDU
OBJECT MODULE PLACED IN .\C_STC12C5404ADMdu.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\CPU_Register\C_STC12C5404ADMdu.c BROWSE INCDIR(..\Hard_Module;..\System_
                    -Function;..\CPU_Register) DEBUG OBJECTEXTEND PRINT(.\C_STC12C5404ADMdu.lst) OBJECT(.\C_STC12C5404ADMdu.obj)

line level    source

   1             
   2          /*======================================================================
   3            版权所有：2010--2099, 河北科技大学  信息科学与工程系 应用电子 孟志永
   4            文 件 名：STC12C5404AD_CMdu.c
   5            作    者: 孟志永
   6            版    本: V1.0
   7            日    期: 2010年7月26日
   8            描述信息: STC12C5404AD的C语言模版 完成硬件模块资源的初始化设置
   9            其他说明: 该模版只是构建了系统最底层的硬件框架
  10                      具体内容可根据需要做相应修改
  11                                  系统时钟采用11.0592MHz            
  12            功能列表: 
  13                                  1、端口初始化
  14                                  2、系统时钟初始化
  15                                  3、定时器T0、1初始化
  16                                  4、ADC0初始化
  17                                  5、串行口初始化
  18                                  6、DAC0初始化
  19                                  7、系统中断初始化
  20                                  8、比较器初始化
  21            历史纪录:   
  22                      1、日    期:
  23                         作    者:
  24                         修改内容:
  25          =======================================================================*/
  26          
  27          /***********************************************************************
  28                        头文件声明部分
  29          ***********************************************************************/
  30          #include "STC12C5620AD_H.h"
  31          
  32          /*=======================================================================
  33          函数名称：Init_Port
  34          函数功能：1、端口模式初始化（上拉、下拉、开漏）
  35                    2、端口方向初始化（输入、输出）
  36                            3、端口初始值    （高电平，低电平）
  37          输入参数：无
  38          输出参数：无
  39          返 回 值：无
  40          其它说明：无
  41          =======================================================================*/
  42          void Init_Port( void ){
  43   1      
  44   1              // 端口模式设置（上拉、下拉、开漏） 
  45   1          
  46   1              // 端口方向设置
  47   1      
  48   1              // 端口初始值设置
  49   1          P0 = 0xFF; 
  50   1              P1 = 0xFF;
  51   1              P2 = 0xFF;
  52   1              P3 = 0xFF;
  53   1      
  54   1              /*=================================================================
C51 COMPILER V8.08   C_STC12C5404ADMDU                                                     07/29/2010 17:32:26 PAGE 2   

  55   1              PnM0[7:0] PnM1[7:0]
  56   1                   0      0        准双向口
  57   1                       0      1        推挽输出
  58   1                       1      0        高阻输入 
  59   1                       1      1        开漏输出
  60   1              =================================================================*/
  61   1      //      P0M0 = 0; P0M1 = 0;  // 默认为准双向口
  62   1      //      P1M0 = 0; P1M1 = 0;  // 默认为准双向口
  63   1      //      P2M0 = 0; P2M1 = 0;  // 默认为准双向口
  64   1      //      P3M0 = 0; P3M1 = 0;  // 默认为准双向口
  65   1      
  66   1      
  67   1      }
  68          
  69          
  70          /*=======================================================================
  71          函数名称：Init_INT0
  72          函数功能：1、外部中断0触发方式初始化
  73                    2、优先级设定
  74                            3、允许外部中断0中断
  75          输入参数：无
  76          输出参数：无
  77          返 回 值：无
  78          其它说明：无
  79          =======================================================================*/
  80          void Init_INT0( void ){
  81   1      
  82   1          IT0   = 1;   // 设置外部中断0为下降沿中断
  83   1              PX0   = 1;   // 外部中断0优先级最高
  84   1              EX0   = 0;       // 开外部中断0  
  85   1      
  86   1      }
  87          
  88          /*=======================================================================
  89          函数名称：Init_Timer0
  90          函数功能：1、定时器T0工作模式初始化
  91                    2、定时器T0初值设定
  92                            3、定时器T0中断模式设置
  93                            4、6MHz晶振  10ms中断一次     允许中断
  94          输入参数：无
  95          输出参数：无
  96          返 回 值：无
  97          其它说明：无
  98          =======================================================================*/
  99          void Init_Timer0( void ){
 100   1      
 101   1              /*================================================
 102   1                    D7     D6    D5   D4    D3     D2    D1   D0
 103   1              TMOD: Gate  C/nT   M1   M0   Gate   C/nT   M1   M0
 104   1                Gate: 计数控制端
 105   1                          1:  引脚高电平时计数   
 106   1                              0:  自由计数
 107   1                        C/nT: 计数时钟源选择
 108   1                          1:  外部引脚技术       
 109   1                              0:  内部定时
 110   1                        M1 M0: 工作方式选择
 111   1                        0   0: 13位计数
 112   1                        0   1: 16位计数
 113   1                        1   0: 8位自动重装载模式
 114   1                        1   1: T0为双8位计数
 115   1              ================================================*/
 116   1          TMOD |= 0x01;
C51 COMPILER V8.08   C_STC12C5404ADMDU                                                     07/29/2010 17:32:26 PAGE 3   

 117   1              TH0   = 0xD5;
 118   1              TL0   = 0x9D;
 119   1              
 120   1              TR0   = 1;   // 启动定时器T0
 121   1              ET0   = 1;       // 开定时器T0中断
 122   1              PT0   = 0;   // 定时器T0优先级设置
 123   1      
 124   1      }
 125          
 126          /*=======================================================================
 127          函数名称：Init_Timer1
 128          函数功能：1、定时器T1工作模式初始化
 129                    2、定时器T1初值设定
 130                            3、定时器T1中断模式设置
 131                            4、16位计数 用高8位表示红外线的计数值 不允许中断
 132          输入参数：无
 133          输出参数：无
 134          返 回 值：无
 135          其它说明：无
 136          =======================================================================*/
 137          void Init_Timer1( void ){
 138   1      
 139   1          TMOD |= 0x20;
 140   1              TH1   = 0xFD;
 141   1              TL1   = 0xFD;   // 9600的波特率
 142   1      
 143   1              TR1   = 1;   // 启动定时器T1
 144   1              ET1   = 0;       // 禁止定时器T1中断
 145   1              PT1   = 0;   // 定时器T1优先级设置
 146   1      
 147   1      }
 148          
 149          /*=======================================================================
 150          函数名称：Init_Serial0
 151          函数功能：1、串行口0工作模式初始化
 152                    2、串行口波特率设定
 153                            3、串行口中断模式初始化
 154          输入参数：无
 155          输出参数：无
 156          返 回 值：无
 157          其它说明：无
 158          =======================================================================*/
 159          void Init_UART0( void ){
 160   1      
 161   1              // 串行口0工作模式初始化 
 162   1          SCON  = 0x50; // 9600波特率
 163   1      
 164   1              PS    = 1; // 串行口0中断优先级设置  为最高 
 165   1              ES    = 1; // 允许串行口0中断
 166   1      
 167   1              TI    = 0; // 清除串行口0发送中断标志
 168   1              RI    = 0; // 清除串行口0接收中断标志
 169   1      
 170   1      }
 171          
 172          /*=======================================================================
 173          函数名称：Init_PCA
 174          函数功能：1、
 175                    2、
 176                            3、
 177          输入参数：无
 178          输出参数：无
C51 COMPILER V8.08   C_STC12C5404ADMDU                                                     07/29/2010 17:32:26 PAGE 4   

 179          返 回 值：无
 180          其它说明：无
 181          =======================================================================*/
 182          /*
 183          void Init_PCA( void ){
 184          
 185                  CMOD   = 0x00; // 继续计数 时钟源为fosc/12
 186                  CCAPM0 = 0x49; // 16位计数器
 187                  CCON   = 0x40; // 启动PCA0
 188          
 189          }
 190          */
 191          
 192          /*=======================================================================
 193          函数名称：Init_WDT
 194          函数功能：初始化看门狗
 195          输入参数：无
 196          输出参数：无
 197          返 回 值：无
 198          其它说明：禁止看门狗
 199          =======================================================================*/
 200          void Init_WDT( void ){
 201   1      
 202   1              /*=================================================================
 203   1              WDT_CONTR: 
 204   1              D7: WDT_FLAG 看门狗溢出标志
 205   1              D6：-
 206   1              D5：ED_WDT   看门狗使能         0 禁止  1  使能
 207   1              D4: CLR_WDT  看门狗清零位       1时重新计数,硬件自动清除
 208   1              D3: IDLE_WDT 1: 空闲模式下看门狗启动  0: 空闲模式下不启动
 209   1              D2 D1 D0: PS2 PS1 PS0    12*分频系数*32768/Fosc 溢出时间
 210   1                         0   0   0  :  2分频
 211   1                                 0   0   1  :  4分频
 212   1                                 0   1   0  :  8分频
 213   1                                 0   1   1  :  16分频
 214   1                                 1   0   0  :  32分频
 215   1                                 1   0   1  :  64分频
 216   1                                 1   1   0  :  128分频
 217   1                                 1   1   1  :  256分频
 218   1              =================================================================*/
 219   1              // 初始值为禁止看门狗，分频系数最大
 220   1              WDT_CONTR = 0x07;
 221   1      
 222   1      }
 223          
 224          /*=======================================================================
 225          函数名称：Init_System
 226          函数功能：系统初始化
 227          输入参数：无
 228          输出参数：无
 229          返 回 值：无
 230          其它说明：
 231          =======================================================================*/
 232          void Init_System( void ){
 233   1      
 234   1              Init_WDT();
 235   1              Init_Port();
 236   1              Init_Timer0();
 237   1              Init_Timer1();
 238   1              Init_INT0();
 239   1              Init_UART0();   
 240   1      //      Init_PCA();
C51 COMPILER V8.08   C_STC12C5404ADMDU                                                     07/29/2010 17:32:26 PAGE 5   

 241   1      
 242   1              EA = 1;
 243   1      
 244   1      }
 245          
 246          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     89    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
